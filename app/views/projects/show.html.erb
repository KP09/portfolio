<div class="container-fluid">
  <div class="row">
    <div class="col-lg-4 col-xs-12 padding-none">
      <div class="side-bar">
        <div class="side-cover-image" style="background-image: linear-gradient(rgba(0,0,0,0.5), rgba(0,0,0,0.4)),
             url('<%= @project.user.cover_photo.nil? ? (cl_image_path ('homepage_dcj50q')) : (cl_image_path @project.user.cover_photo.path) %>')">
          <div class="side-bar-profile-image">
            <% if @project.user.profile_picture? %>
              <%= cl_image_tag @project.user.profile_picture.path, width: 100, height: 100, crop: :fill, class: "avatar-large" %>
            <% else %>
              <%= cl_image_tag 'sample', width: 100, height: 100, crop: :fill, class: "avatar-large" %>
            <% end %>
          </div>
        </div>
        <div class="side-bar-name text-center">
          <h1><%= @project.user.first_name %> <%= @project.user.last_name %></h1>
          <div class="side-bar-about">
            <p><%= @project.user.bio %></p>
          </div>
          <% if @project.user == @current_user %>
              <!-- // <a href="/projects" class="btn-primary" onclick="return confirm('Are you sure?')">Delete project</a> -->
              <%= link_to "Delete project", project_path(@project), method: :delete, onclick: "return confirm ('Are you sure?')", class: "btn btn-default" %>
              <br>
              <div >
              	<%= link_to "Edit project", edit_project_path(@project), class: "btn btn-default" %>
              </div>
            <% end %>
        </div>
      </div>
    </div>
    <div class="col-xs-12 col-lg-8 main-body-background">
      <div class="body-padding margin-left">
        <div class="row">
          <div class="col-lg-8">
            <h1><%= @project.title %></h1>
            <div class="main-body-box">
              <div class="task-title">
                <div><p>Brief</p></div>
                  <div class="shift-right">
                    <div class="project_remaining_days">
                      <% days_left = (@project.end_date.to_date - DateTime.now.to_date).to_i %>
                      <% if days_left > 0 then %>
                      <p><%= days_left %> days left</p>
                      <% else %>
                        <p>Closed</p>
                      <% end %>
                    </div>

                    <% if @project.max_joins == nil then  %>
                      <div class="pill">
                        <p><%= @project.category %></p>
                      </div>
                    <% else %>
                      <div class="pill">
                        <% joins_remaining = (@project.max_joins) - (@project.participations.count) %>
                        <p><%= joins_remaining %> Spaces Left</p>
                      </div>
                      <div class="pill">
                        <p><%= @project.category %></p>
                      </div>
                    <% end %>

                </div>
              </div>
              <div class="brief-show-page">
               <p><%= @project.brief %></p>
              </div>
            </div>


        <div class="main-body-box">
          <% if days_left > 0 then %>
            <div class="task-title">
              <p>Whats Next?
                <% if @current_user.contributed_to?(@project) %>
                  Update Contribution
                <% elsif @current_user.participated_to?(@project) %>
                  Upload Contribution
                <% else %>
                  Join the Project Below
                <% end %>
              </p>
            </div>
              <div class="upload-contribution-form">
                <% if @current_user.contributed_to?(@project) %>
                  <div><%= simple_form_for([@current_user.participation(@project), @contribution]) do |f| %>
                      <%= f.input :comment %>
                      <%= f.input :file %>
                      <%= f.input :file_cache, as: :hidden %>
                      <%= f.submit "Update contribution to project", class: "btn btn-primary" %>
                    <% end %>
                  </div>
                <% elsif @current_user.participated_to?(@project) %>
                  <div>
                    <p>So you have been hard at work completing this project. The time has come to upload your contribution. Woohoo. Please use the form below to get your work sent to the project owner! Remember all contributions can be accessed on your profile!</p>
                    <%= simple_form_for([@current_user.participation(@project), @contribution]) do |f| %>
                      <%= f.input :comment, class: "form-control" %>
                      <%= f.input :file %>
                      <%= f.input :file_cache, as: :hidden %>
                      <div class="text-center">
                      	<%= f.submit "Contribute to project", class: "btn btn-primary" %>
                      </div>
                    <% end %>
                  </div>
                <% else %>
                	<div class="text-center">
                  	<%= link_to "Join project", project_participations_path(@project), class: "btn btn-primary", method: :post %>
                  </div>
                <% end %>
              </div>
          <% else %>
            <div class="task-title">
              <p>All Contributions</p>
            </div>
              <% @project.contributions.each do | contribution | %>
                <div id="contributions-container-show" style="padding: 15px;">
                  <div class="contribution-header flex-between">
                    <%= cl_image_tag 'sample', width: 30, height: 30, crop: :fill, class: "avatar-xs" %>
                    <div class="project-title">
                      <h3>
                        <%= link_to contribution.project.title, project_path(contribution.project), class: "contribution-header-link" %>
                        for
                        <%= link_to contribution.project.user.full_name, user_path(contribution.project.user), class: "contribution-header-link" %>
                      </h3>
                    </div>
                  </div>
                  <hr>
                  <div class="contribution-content flex-between">
                    <%= link_to cl_image_path(contribution.file), class: "contribution-body-link" do %>
                      <p><%= contribution.comment %></p>
                    <% end %>
                  </div>
                </div>
              <% end %>
            <% end %>
        </div>
      </div>

        <div class="col-lg-4">
          <% if days_left > 0 then %>
            <div class="main-body-box">
              <div class="task-title">
                <div>
                  <p>There are currently <%= @project.participations.count %> people working on this project :</p>
                </div>
              </div>
              <div class="joins">
                <% @project.participations.each do |participation| %>
                   <!-- ADD USER.PHOTO IN AVATAR > MAY WANT TO DO A FLEXBOX -->
                <div class="flex-contributers">
                  <div class="left">
                    <% if participation.user.profile_picture? %>
                      <%= cl_image_tag participation.user.profile_picture.path, width: 50, height: 50, crop: :fill, class: "avatar-small" %>
                    <% else %>
                      <%= cl_image_tag 'sample', width: 50, height: 50, crop: :fill, class: "avatar-small" %>
                     <% end %>
                  </div>
                  <div class="right">
                     <!-- <img src="participation.user.profile_picture" alt=""> -->
                     <p class="details"><%= participation.user.first_name %> <%= participation.user.last_name %></p>
                  </div>
                  <div class="far-right">
                     <% if participation.user.contributed_to?(@project) %>
                        <div class="contributed-tick text-center">
                          <div class="contribution-check">
                            <i class="fa fa-check"></i>
                          </div>
                        </div>
                      <% end %>
                  </div>
                </div>
               <br>
               <% end %>
              </div>
            </div>
          <% else %>
            <div class="main-body-box">
              <div class="task-title">
                <div>
                  <% if @project.contributions.count == 1 %>
                    <p>There was <%= @project.contributions.count %> contribution made to this project:</p>
                  <% else %>
                    <p>There were <%= @project.contributions.count %> contributions made to this project:</p>
                  <% end %>
                </div>
              </div>
              <div class="joins">
                <% @project.contributions.each do |contribution| %>
                   <!-- ADD USER.PHOTO IN AVATAR > MAY WANT TO DO A FLEXBOX -->
                <div class="flex-contributers">
                  <div class="left">
                    <% if contribution.user.profile_picture? %>
                      <%= cl_image_tag contribution.user.profile_picture.path, width: 50, height: 50, crop: :fill, class: "avatar-small" %>
                    <% else %>
                      <%= cl_image_tag 'sample', width: 50, height: 50, crop: :fill, class: "avatar-small" %>
                    <% end %>
                  </div>
                  <div class="right">
                     <!-- <img src="participation.user.profile_picture" alt=""> -->
                     <p class="details"><%= contribution.user.first_name %> <%= contribution.user.last_name %></p>
                  </div>
                </div>
               <br>
              <% end %>
              <% end %>
              </div>

            <% if @current_user.participated_to?(@project) %>

              <div class="text-center">
                <%= link_to "Leave project", participation_path(current_user.participations.where(project_id: @project.id).first), method: :delete, class: "btn btn-default" %>
              </div>
              <% end %>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
